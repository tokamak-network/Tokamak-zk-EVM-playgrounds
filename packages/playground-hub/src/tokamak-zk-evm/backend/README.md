# Tokamak-zk-EVM/backend

## What are the backend algorithms
You can convert your Ethereum transactions into zero-knowledge proofs (zkp) even if you don't know zkp.

The three algorithms, "setup", "prove", and "verify", are rust implementation of the backend algorithms defined in [the Tokamak zk-SNARK manuscript](https://eprint.iacr.org/2024/507).
They take a zkp circuit specialized for a transaction as their input. The circuit should be pre-processed by [the frontend compilers](../frontend/).
More specifically,
- setup/trusted-setup: it takes a library of subcircuits generated by [the QAP-compiler](../frontend/qap-compiler/) as input and generates a reference string and commitments to the subcircuit library.
- prove: it takes the subcircuit library and the transaction-specific details generated by [the Synthesizer](../frontend/synthesizer) as input and generates a zk proof.
- verify: it takes public inputs, the setup outputs, and the zk proof as input and accept or reject the proof.

## How to use (tentative)?
### A. Prerequisite (tentative)
- You may need to install at least rust, cmake, curl, and clang.
- We will figure out the minimal requirements soon.
### B. Build the backend packages
- Make sure you are in "Tokamak-zk-EVM/packages/backend".
- Build every algorithm by entering
    ```shell
    cargo build
    ```
### C. Run the Setup
- Run the setup for a given library of subcircuits.
- This is a one-time setup, required to be re-run only when there are changes to the QAP-compiler configuration.
- Make sure you are in "Tokamak-zk-EVM/packages/backend" and enter
    ```shell
    cargo run -p trusted-setup
    ```
### D. Run the main protocol (Prove and Verify)
- Run the main protocol to generate a transaction-specific proof and verify it.
- Make sure you are in "Tokamak-zk-EVM/packages/backend" and enter
    ```shell
    cargo run -p protocol-script
    ```

## Description for the Setup input and output
### Input
The setup (both trusted- and MPC-setups) requires the only input from the QAP-compiler, which is [a library of subcircuits](../frontend/qap-compiler/subcircuits/library). This input would be more likely fixed. It will be changed whenever there is a change in the EVM's spec.
### Output
You can find the only setup output from [the "output" folder](./setup/trusted-setup/output), named "combined_sigma.json", which is denoted and defined as $\mathbb{\sigma}$ in the manuscript. The output would rarely change, as it depends on the EVM sepc.

## Description for the Prove input and output
### Input
The prove takes its input from the following three paths:
- The setup outputs,
- [A library of subcircuits](../frontend/qap-compiler/subcircuits/library) generated by the QAP-compiler, and
- transaction-specific details such as the subcircuits combination, wire map, instances, and witnesses analyzed by the Synthesizer.
### Output
- Zk proof of correct execution of a transaction (THE OUTPUT WILL BE STORED AS A FILE IN THE NEAR FUTURE)

## Description for the Verify input and output
### Input
The verify takes its input from the following three paths:
- The setup outputs,
- The zk proof, and
- [Public inputs](../frontend/synthesizer/examples/outputs/publicInstance.json) provided by the Synthesizer.
### Output
- It will display a message "passed", if the zk proof is verified.

## Contributing
We welcome contributions! Please see our [Contributing Guidelines](../../CONTRIBUTING.md) for details.

## Original contribution
- [JehyukJang](https://github.com/JehyukJang): Algorithms design, analysis, implementation, and optimization.
- [jason hwang](https://github.com/cd4761): Parallel computing-relevant optimization of the implementations.

## License
[MPL-2.0]
